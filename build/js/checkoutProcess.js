var c=(r,e,t)=>new Promise((s,o)=>{var a=i=>{try{l(t.next(i))}catch(n){o(n)}},h=i=>{try{l(t.throw(i))}catch(n){o(n)}},l=i=>i.done?s(i.value):Promise.resolve(i.value).then(a,h);l((t=t.apply(r,e)).next())});import{getLocalStorage as m,setLocalStorage as u,alertMessage as d,removeAllAlerts as p}from"./utils.js";import g from"./externalServices.js";const T=new g;function f(r){const e=new FormData(r),t={};return e.forEach(function(s,o){t[o]=s}),t}function y(r){const e=r.map(t=>(console.log(t),{id:t.Id,price:t.FinalPrice,name:t.Name,quantity:t.qty}));return e}export default class x{constructor(e,t){this.shipping=0,this.tax=0,this.itemTotal=0,this.orderTotal=0,this.numItems=0,this.list=[],this.key=e,this.outputSelector=t}init(){this.list=m(this.key),this.calculateItemSummary()}calculateItemSummary(){for(var e of this.list)this.itemTotal+=e.FinalPrice*e.qty,this.numItems+=e.qty;document.querySelector("#subtotal").innerHTML="$"+this.itemTotal.toFixed(2)}calculateOrdertotal(){this.shipping=10+(this.numItems-1)*2,this.tax=(this.itemTotal*.06).toFixed(2),this.orderTotal=(parseFloat(this.itemTotal)+parseFloat(this.shipping)+parseFloat(this.tax)).toFixed(2),this.displayOrderTotals()}displayOrderTotals(){document.querySelector("#tax").innerHTML="$"+this.tax,document.querySelector("#shippingEst").innerHTML="$"+this.shipping,document.querySelector("#orderTotal").innerHTML="$"+this.orderTotal}checkout(){return c(this,null,function*(){const e=document.forms.checkout,t=f(e);t.orderDate=new Date,t.orderTotal=this.orderTotal,t.tax=this.tax,t.shipping=this.shipping,t.items=y(this.list),console.log(t);try{const s=yield T.checkout(t);console.log(s),u("so-cart",[]),window.location.href="./checkedout.html"}catch(s){p();const o=yield s.message;for(let a in o)d(o[a]);console.log(s)}})}}
